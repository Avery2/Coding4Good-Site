<!doctype html>
<html>
<head>
    <% include template/head.ejs %>
    <script>
      $(function () {
        $("#project-form").submit(function () {
          if (($("#title").val() == '') | ($("#description").val() == '') | ($("#contact").val() == '') | ($("#npo").val() == '')) {
            $("#error-msg").html('Please fill out all the fields');
            return false;
          }
          var leader=$("#leader-search").val();
          var leaderSplit=leader.split(". ");
          allUserNameAndId.forEach(function (user) {
              if(user.id == leaderSplit[0]){
                  if(user.name === leaderSplit[1]){
                      leader = user.id;
                  }
                  $("#error-msg").html('Please select leader from the list, or type valid info in the create format');
                  return false;
              }
          })
          var teams = [{id:1, memberTitle:"Leader"}, {id:2, memberTitle:"Member"},{id:3,memberTitle:"Member"},{id:4,memberTitle:"Member"},{id:5,memberTitle:"Member"}];
          $.ajax({
            url: "/api/project/createProject",
            method: "POST",
            dataType: "json",
            data: {
              title: $("#title").val(),
              description: $("#description").val(),
              contact: $("#contact").val(),
              npo: $("#npo").val(),
              status: StatusEnum.InProgress,
              team:teams
            },
            success: function () {
              window.location.href = "/project";
            },
            error: function (jqXHR, textStatus, errorThrown) {
              $("#error-msg").html(jqXHR.responseJSON);
            }
          });
          return false;
        });
      });
    </script>
</head>
<body>

<% include template/nav.ejs %>
<div class="creat-project">
    <div class="col-sm-8-offset" align="right">
      <a class="btn primary-button" href="/project">Back</a>
    </div>
    <p class="error-msg" id="error-msg"></p>
    <form id="project-form">
        <div class="input-group new-project-input">
            <div class="input-group-addon">Project Title:&nbsp;</div>
            <input class="form-control" type="text" id="title" placeholder="Title">
        </div>

        <div class="input-group new-project-input">
            <div class="input-group-addon">Leader:&nbsp;&nbsp;&nbsp;&nbsp;</div>
            <input class="form-control dropdown-item" type="text" id="leader-search" value="" placeholder="Search For Leader" list="leader-list"/>
            <datalist id = "leader-list" class="dropdown-toggle">
                <% allUserNameAndId.forEach(function(user){ %>
                   <option class="dropdown-item"><%= user.id%>. <%= user.name%></option>
                <% }) %>
            </datalist>
        </div>
        <!--<div class="input-group new-project-input">-->
            <!--<div class="input-group-addon">Members:</div>-->
            <!--<input class="form-control" type="text" id="members-search" placeholder="Search For Member">-->
            <!--<datalist id = "member-list" class="dropdown-toggle">-->
                <!--<% allUserNameAndId.forEach(function(user){ %>-->
                <!--<option class="dropdown-item" id="<%= user.id%>>"><%= user.name%></option>-->
                <!--<% }) %>-->
            <!--</datalist>-->
        <!--</div>-->

        <div class="input-group new-project-input">
            <div class="input-group-addon">Contact Info:</div>
            <input class="form-control" type="text" id="contact" placeholder="Contact">
        </div>

        <div class="input-group new-project-input">
            <div class="input-group-addon">Non-profit Organization Name:</div>
            <input class="form-control" type="text" id="npo" placeholder="Non-profit Organization Name">
        </div>

        <div class="new-project-input">
            <textarea class="form-control" type="text" id="description" placeholder="Description" rows="10"></textarea>
        </div>

    </form>
    <button type="submit" form="project-form" class="btn login-signup-btn primary-button">Create!</button>
</div>

<% include template/footer.ejs %>
</body>
</html>
